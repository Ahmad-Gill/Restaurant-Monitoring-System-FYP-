{% extends "HtmlFiles/Base.html" %}
{% load static %}

{% block title %}Restaurant CCTV Analysis{% endblock title %}

{% block body %}
<style>
    body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 20px;
        background-color: #f4f4f4;
    }
    h1, h2 {
        color: white;
    }
    #dashboard {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
    }
    .status-box {
        background-color: black;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 10px;
        width: 30%;
        color: white;
    }
    #violation-log {
        background-color: black;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 20px;
        height: 300px;
        overflow-y: auto;
        color: white;
    }
    .violation {
        color: red;
        margin-bottom: 10px;
    }
    button {
        background-color: #4CAF50;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-bottom: 20px;
        margin-right: 10px;
    }
    button:hover {
        background-color: #45a049;
    }
    #stopButton {
        background-color: #f44336;
    }
    #stopButton:hover {
        background-color: #d32f2f;
    }
    .culprit-info {
        font-weight: bold;
        color: #FF5733;
    }
</style>
<link rel="stylesheet" href="{% static 'css/restaurant_cctv.css' %}">

<h1>Restaurant CCTV Analysis</h1>

<button onclick="startSimulation()" id="startButton">Start Simulation</button>
<button onclick="stopSimulation()" id="stopButton" disabled>Stop Simulation</button>

<div id="dashboard">
    <div class="status-box">
        <h2>Tables</h2>
        <p id="table-status">All tables clean</p>
    </div>
    <div class="status-box">
        <h2>Chefs</h2>
        <p id="chef-status">All chefs compliant</p>
    </div>
    <div class="status-box">
        <h2>Waiters</h2>
        <p id="waiter-status">All waiters compliant</p>
    </div>
</div>

<h2>Violation Log</h2>
<div id="violation-log"></div>

<script src="{% static 'js/restaurant_cctv.js' %}"></script>
<script>
    const tables = [
        { id: 'T001', location: 'Main Hall' },
        { id: 'T002', location: 'Patio' },
        { id: 'T003', location: 'Bar Area' },
        { id: 'T004', location: 'Private Room' },
        { id: 'T005', location: 'Window Side' }
    ];
    const chefs = [
        { id: 'C001', name: 'Abbas', station: 'Grill' },
        { id: 'C002', name: 'Kazim', station: 'Salad' },
        { id: 'C003', name: 'Munir', station: 'Pastry' }
    ];
    const waiters = [
        { id: 'W001', name: 'Ahmad', section: 'Main Hall' },
        { id: 'W002', name: 'Hassan', section: 'Patio' },
        { id: 'W003', name: 'Sohaib', section: 'Bar Area' },
        { id: 'W004', name: 'Mohsin', section: 'Private Room' }
    ];

    let simulationInterval;
    let violations = { tables: {}, chefs: {}, waiters: {} };

    function startSimulation() {
        simulationInterval = setInterval(simulateViolation, 3000);
        document.getElementById('startButton').disabled = true;
        document.getElementById('stopButton').disabled = false;
    }

    function stopSimulation() {
        clearInterval(simulationInterval);
        document.getElementById('startButton').disabled = false;
        document.getElementById('stopButton').disabled = true;
    }

    function simulateViolation() {
        const violationType = Math.floor(Math.random() * 3);
        let violation = '';

        switch(violationType) {
            case 0:
                violation = simulateTableViolation();
                break;
            case 1:
                violation = simulateChefViolation();
                break;
            case 2:
                violation = simulateWaiterViolation();
                break;
        }

        if (violation) {
            logViolation(violation);
            updateDashboard();
        }
    }

    function simulateTableViolation() {
        const table = tables[Math.floor(Math.random() * tables.length)];
        if (Math.random() < 0.3) {
            violations.tables[table.id] = (violations.tables[table.id] || 0) + 1;
            return `Table ${table.id} (${table.location}) is dirty`;
        }
        return '';
    }

    function simulateChefViolation() {
        const chef = chefs[Math.floor(Math.random() * chefs.length)];
        if (Math.random() < 0.2) {
            violations.chefs[chef.id] = (violations.chefs[chef.id] || 0) + 1;
            return `Chef ${chef.id} (${chef.name}, ${chef.station} station) is not wearing an apron`;
        } else if (Math.random() < 0.2) {
            violations.chefs[chef.id] = (violations.chefs[chef.id] || 0) + 1;
            return `Chef ${chef.id} (${chef.name}, ${chef.station} station) is not wearing a head cap`;
        }
        return '';
    }

    function simulateWaiterViolation() {
        const waiter = waiters[Math.floor(Math.random() * waiters.length)];
        if (Math.random() < 0.2) {
            violations.waiters[waiter.id] = (violations.waiters[waiter.id] || 0) + 1;
            return `Waiter ${waiter.id} (${waiter.name}, ${waiter.section}) is not wearing proper uniform`;
        } else if (Math.random() < 0.2) {
            violations.waiters[waiter.id] = (violations.waiters[waiter.id] || 0) + 1;
            return `Waiter ${waiter.id} (${waiter.name}, ${waiter.section}) is not wearing a name tag`;
        }
        return '';
    }

    function logViolation(violation) {
        const logElement = document.getElementById('violation-log');
        const violationElement = document.createElement('div');
        violationElement.className = 'violation';
        violationElement.innerHTML = `${new Date().toLocaleTimeString()}: <span class="culprit-info">${violation}</span>`;
        logElement.insertBefore(violationElement, logElement.firstChild);
    }

    function updateDashboard() {
        const tableStatus = document.getElementById('table-status');
        const chefStatus = document.getElementById('chef-status');
        const waiterStatus = document.getElementById('waiter-status');

        const dirtyTables = Object.keys(violations.tables).length;
        const nonCompliantChefs = Object.keys(violations.chefs).length;
        const nonCompliantWaiters = Object.keys(violations.waiters).length;

        tableStatus.textContent = dirtyTables > 0 ? `${dirtyTables} table(s) need attention` : 'All tables clean';
        chefStatus.textContent = nonCompliantChefs > 0 ? `${nonCompliantChefs} chef(s) non-compliant` : 'All chefs compliant';
        waiterStatus.textContent = nonCompliantWaiters > 0 ? `${nonCompliantWaiters} waiter(s) non-compliant` : 'All waiters compliant';
    }
</script>
{% endblock %}